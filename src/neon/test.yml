doc: Built file to test builds
default:
- builtin_throw
- builtin_find

properties:
  BUILD_DIR: "../../build"

targets:

  builtin_throw:
    doc: Test the throw builtin function
    steps:
    - try:
      - script: 'throw("TEST")'
      catch:
      - script: |
          if error != "evaluating script: TEST" {
            throw("Throw test failure")
          } else {
            println("Throw test success")
          }

  builtin_find:
    doc: Test the find builtin function
    steps:
    - delete: "#{BUILD_DIR}"
    - mkdir: "#{BUILD_DIR}/spam"
    - "touch #{BUILD_DIR}/foo #{BUILD_DIR}/spam/bar"
    - script: |
          files = toString(find(BUILD_DIR, "**/*"))
          if files != "[foo spam spam/bar]" {
            throw("ERROR: " + files)
          } else {
            println("Find test success")
          }
